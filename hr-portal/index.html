<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Onboarding Details</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #ffffff;
            color: #333;
            line-height: 1.6;
        }

        header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 2rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .banner-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .circle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
        }

        .circle:nth-child(1) {
            width: 300px;
            height: 300px;
            top: -100px;
            right: -100px;
        }

        .circle:nth-child(2) {
            width: 200px;
            height: 200px;
            bottom: -50px;
            left: -50px;
        }

        .circle:nth-child(3) {
            width: 150px;
            height: 150px;
            bottom: 100px;
            right: 50px;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            position: relative;
            z-index: 1;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .filters-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .left-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 0.9rem;
            min-width: 180px;
        }

        .search-container {
            position: relative;
            flex-grow: 1;
            max-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            padding-left: 2.5rem;
            border-radius: 6px;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23999' viewBox='0 0 16 16'%3E%3Cpath d='M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 0.8rem center;
            background-size: 1rem;
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .employee-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .card-header {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            background-color: #f9fafb;
            border-bottom: 1px solid #eee;
        }

        .profile-image {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #4f46e5;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }

        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-initials {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #4f46e5;
            color: white;
        }

        .employee-info {
            flex-grow: 1;
        }

        .employee-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.2rem;
            color: #111827;
        }

        .job-role {
            font-size: 0.9rem;
            color: #6b7280;
        }

        .card-body {
            padding: 1.5rem;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .info-label {
            color: #6b7280;
            font-weight: 500;
        }

        .info-value {
            color: #111827;
            text-align: right;
        }

        .experience-tag {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .experience-tag.fresher {
            background-color: #e0f2fe;
            color: #0369a1;
        }

        .experience-tag.experienced {
            background-color: #dcfce7;
            color: #166534;
        }

        .card-actions {
            margin-top: 1.5rem;
        }

        .btn {
            display: inline-block;
            padding: 0.5rem 1rem;
            background-color: #4f46e5;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.2s;
            text-align: center;
            width: 100%;
        }

        .btn:hover {
            background-color: #4338ca;
        }

        .view-details {
            background-color: transparent;
            border: 1px solid #4f46e5;
            color: #4f46e5;
        }

        .view-details:hover {
            background-color: #f5f3ff;
        }

        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(79, 70, 229, 0.2);
            border-top-color: #4f46e5;
            border-radius: 50%;
            margin: 0 auto 1rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 2rem auto;
            max-width: 900px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .modal-header {
            padding: 1.5rem;
            background-color: #4f46e5;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0 0.5rem;
        }

        .section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            padding: 1.5rem;
        }

        @media (max-width: 768px) {
            .section-grid {
                grid-template-columns: 1fr;
            }
        }

        .modal-section {
            background-color: #f9fafb;
            border-radius: 8px;
            padding: 1.5rem;
        }

        .modal-section h3 {
            margin-bottom: 1rem;
            color: #4f46e5;
            font-size: 1.1rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
        }

        .info-item {
            margin-bottom: 1rem;
        }

        .info-item strong {
            display: block;
            color: #6b7280;
            font-size: 0.85rem;
            margin-bottom: 0.2rem;
        }

        .info-item span {
            color: #111827;
            font-size: 0.95rem;
        }

        .documents-section {
            grid-column: 1 / -1;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .doc-btn {
            background-color: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }

        .doc-btn h4 {
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .download-doc {
            color: #4f46e5;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .download-doc:hover {
            background-color: #f5f3ff;
        }

        .disabled {
            color: #9ca3af;
            cursor: not-allowed;
        }

        .modal-actions {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
            text-align: right;
        }

        .modal-profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            overflow: hidden;
            background-color: #4f46e5;
            position: relative;
        }

        .modal-profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-profile-initials {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <div class="banner-background">
            <div class="circle"></div>
            <div class="circle"></div>
            <div class="circle"></div>
        </div>
        <h1>Employee Onboarding Details</h1>
        <p>Manage and access Employee Onboarding Details</p>
    </header>

    <div class="container">
        <div class="filters-container">
            <div class="left-filters">
                <select class="filter-dropdown" id="monthFilter">
                    <option value="">All Months</option>
                    <option value="01">January</option>
                    <option value="02">February</option>
                    <option value="03">March</option>
                    <option value="04">April</option>
                    <option value="05">May</option>
                    <option value="06">June</option>
                    <option value="07">July</option>
                    <option value="08">August</option>
                    <option value="09">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
                
                <select class="filter-dropdown" id="experienceFilter">
                    <option value="">All Experience Levels</option>
                    <option value="Fresher">Fresher</option>
                    <option value="Experienced">Experienced</option>
                </select>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search employees...">
            </div>
        </div>
        
        <div class="employee-grid" id="employee-grid">
            <div class="loading">
                <div class="spinner"></div>
                Loading employee data...
            </div>
        </div>
    </div>

    <!-- Employee Detail Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalEmployeeName"></h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <div class="modal-profile-image" id="modalProfileImage">
                        <div class="modal-profile-initials" id="modalProfileInitials"></div>
                    </div>
                    <h3>Personal Information</h3>
                    <div class="info-item">
                        <strong>Full Name</strong>
                        <span id="modalName"></span>
                    </div>
                    <div class="info-item">
                        <strong>Email Address</strong>
                        <span id="modalEmail"></span>
                    </div>
                    <div class="info-item">
                        <strong>Mobile Number</strong>
                        <span id="modalMobile"></span>
                    </div>
                    <div class="info-item">
                        <strong>Date of Birth</strong>
                        <span id="modalDob"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Employment Details</h3>
                    <div class="info-item">
                        <strong>Job Role</strong>
                        <span id="modalJobRole"></span>
                    </div>
                    <div class="info-item">
                        <strong>Department</strong>
                        <span id="modalDepartment"></span>
                    </div>
                    <div class="info-item">
                        <strong>Joining Date</strong>
                        <span id="modalJoiningDate"></span>
                    </div>
                    <div class="info-item">
                        <strong>Experience</strong>
                        <span id="modalExperience"></span>
                    </div>
                    <div class="info-item" id="experienceCompanyItem" style="display: none;">
                        <strong>Previous Company</strong>
                        <span id="modalExperienceCompany"></span>
                    </div>
                    <div class="info-item" id="experienceYearsItem" style="display: none;">
                        <strong>Years of Experience</strong>
                        <span id="modalExperienceYears"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>Address Information</h3>
                    <div class="info-item">
                        <strong>Address</strong>
                        <span id="modalAddress"></span>
                    </div>
                    <div class="info-item">
                        <strong>City</strong>
                        <span id="modalCity"></span>
                    </div>
                    <div class="info-item">
                        <strong>State</strong>
                        <span id="modalState"></span>
                    </div>
                    <div class="info-item">
                        <strong>Zipcode</strong>
                        <span id="modalZipcode"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Bank Details</h3>
                    <div class="info-item">
                        <strong>Bank Name</strong>
                        <span id="modalBank"></span>
                    </div>
                    <div class="info-item">
                        <strong>Account Number</strong>
                        <span id="modalAccount"></span>
                    </div>
                    <div class="info-item">
                        <strong>IFSC Code</strong>
                        <span id="modalIfsc"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch Location</strong>
                        <span id="modalBankBranch"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>Education Details</h3>
                    <div class="info-item">
                        <strong>SSC School</strong>
                        <span id="modalSscSchool"></span>
                    </div>
                    <div class="info-item">
                        <strong>SSC Year</strong>
                        <span id="modalSscYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>SSC Grade</strong>
                        <span id="modalSscGrade"></span>
                    </div>
                </div>

                <div class="modal-section">
                    <h3>Intermediate/Diploma</h3>
                    <div class="info-item">
                        <strong>College</strong>
                        <span id="modalInterCollege"></span>
                    </div>
                    <div class="info-item">
                        <strong>Year</strong>
                        <span id="modalInterYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>Grade</strong>
                        <span id="modalInterGrade"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch</strong>
                        <span id="modalInterBranch"></span>
                    </div>
                </div>
            </div>

            <div class="section-grid">
                <div class="modal-section">
                    <h3>Graduation Details</h3>
                    <div class="info-item">
                        <strong>University</strong>
                        <span id="modalGradCollege"></span>
                    </div>
                    <div class="info-item">
                        <strong>Year</strong>
                        <span id="modalGradYear"></span>
                    </div>
                    <div class="info-item">
                        <strong>Grade</strong>
                        <span id="modalGradGrade"></span>
                    </div>
                    <div class="info-item">
                        <strong>Degree</strong>
                        <span id="modalGradDegree"></span>
                    </div>
                    <div class="info-item">
                        <strong>Branch</strong>
                        <span id="modalGradBranch"></span>
                    </div>
                </div>
            </div>

            <div class="modal-section documents-section">
                <h3>Documents</h3>
                <div class="documents-grid" id="documentsGrid">
                    <!-- Documents will be added here -->
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn" id="downloadPdfBtn">
                    Export to PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Include jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script>
        const { jsPDF } = window.jspdf;

        let currentEmployee = null;
        let allEmployees = [];

        // Fetch employee data
        fetch('http://3.84.202.40:3000/employees')
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.json();
            })
            .then(data => {
                allEmployees = data;
                renderEmployeeGrid(data);
                setupFilters();
                setupSearch();
            })
            .catch(error => {
                document.getElementById('employee-grid').innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        Error loading data: ${error.message}
                    </div>`;
                console.error('Error fetching employee data:', error);
            });

        // Modal elements
        const modal = document.getElementById('employeeModal');
        const closeModal = document.getElementById('closeModal');

        closeModal.addEventListener('click', () => modal.style.display = 'none');
        window.addEventListener('click', (event) => {
            if (event.target === modal) modal.style.display = 'none';
        });

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'N/A';
            
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        function getInitials(name) {
            if (!name) return '?';
            const parts = name.split(' ');
            let initials = parts[0].charAt(0).toUpperCase();
            if (parts.length > 1) {
                initials += parts[parts.length - 1].charAt(0).toUpperCase();
            }
            return initials;
        }

        function setupFilters() {
            const monthFilter = document.getElementById('monthFilter');
            const experienceFilter = document.getElementById('experienceFilter');
            
            monthFilter.addEventListener('change', filterEmployees);
            experienceFilter.addEventListener('change', filterEmployees);
        }

        function filterEmployees() {
            const monthFilter = document.getElementById('monthFilter').value;
            const experienceFilter = document.getElementById('experienceFilter').value;
            
            let filtered = allEmployees;
            
            if (monthFilter) {
                filtered = filtered.filter(emp => {
                    if (!emp.emp_joining_date) return false;
                    const joinMonth = emp.emp_joining_date.split('-')[1];
                    return joinMonth === monthFilter;
                });
            }
            
            if (experienceFilter) {
                filtered = filtered.filter(emp => {
                    if (experienceFilter === 'Fresher') {
                        return !emp.emp_experience_status || emp.emp_years_of_experience === 0;
                    } else {
                        return emp.emp_experience_status === 'Experienced' && emp.emp_years_of_experience > 0;
                    }
                });
            }
            
            renderEmployeeGrid(filtered);
        }

        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                if (searchTerm.length === 0) {
                    filterEmployees();
                    return;
                }
                
                const filtered = allEmployees.filter(emp => 
                    emp.emp_name.toLowerCase().includes(searchTerm) ||
                    emp.emp_email.toLowerCase().includes(searchTerm) ||
                    (emp.emp_job_role && emp.emp_job_role.toLowerCase().includes(searchTerm)) ||
                    (emp.emp_department && emp.emp_department.toLowerCase().includes(searchTerm)) ||
                    (emp.emp_mobile && emp.emp_mobile.toLowerCase().includes(searchTerm))
                );
                
                renderEmployeeGrid(filtered);
            });
        }

        // Download single document
        async function downloadDocument(docUrl) {
            try {
                if (!docUrl) {
                    alert('Document not available');
                    return;
                }

                const filename = docUrl.split('/').pop() || 'document';
                const a = document.createElement('a');
                a.href = docUrl;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } catch (error) {
                console.error('Download error:', error);
                alert(`Download failed: ${error.message}`);
            }
        }

        function renderEmployeeGrid(employees) {
            const employeeGrid = document.getElementById('employee-grid');
            employeeGrid.innerHTML = '';

            if (employees.length === 0) {
                employeeGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem;">
                        No employee records found matching your criteria
                    </div>`;
                return;
            }

            employees.forEach(employee => {
                const card = document.createElement('div');
                card.className = 'employee-card';

                // Determine experience status
                let experienceStatus;
                if (employee.emp_experience_status === 'Experienced' && employee.emp_years_of_experience > 0) {
                    experienceStatus = `<span class="experience-tag experienced">${employee.emp_years_of_experience} yrs experience</span>`;
                } else {
                    experienceStatus = `<span class="experience-tag fresher">Fresher</span>`;
                }

                // Create profile image element
                let profileImageHtml = '';
                if (employee.emp_profile_pic_url) {
                    profileImageHtml = `
                        <div class="profile-image">
                            <img src="${employee.emp_profile_pic_url}" alt="${employee.emp_name}">
                            <div class="profile-initials">${getInitials(employee.emp_name)}</div>
                        </div>
                    `;
                } else {
                    profileImageHtml = `
                        <div class="profile-image">
                            <div class="profile-initials">${getInitials(employee.emp_name)}</div>
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="card-header">
                        ${profileImageHtml}
                        <div class="employee-info">
                            <h3>${employee.emp_name}</h3>
                            <div class="job-role">${employee.emp_job_role || 'Not specified'}</div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="info-row">
                            <span class="info-label">Joining Date</span>
                            <span class="info-value">${formatDate(employee.emp_joining_date)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Contact</span>
                            <span class="info-value">${employee.emp_mobile || 'N/A'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Email</span>
                            <span class="info-value">${employee.emp_email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Status</span>
                            <span class="info-value">${experienceStatus}</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn view-details" data-email="${employee.emp_email}">
                                View Details
                            </button>
                        </div>
                    </div>
                `;
                employeeGrid.appendChild(card);
            });

            document.querySelectorAll('.view-details').forEach(button => {
                button.addEventListener('click', function() {
                    const employeeEmail = this.getAttribute('data-email');
                    const employee = allEmployees.find(emp => emp.emp_email === employeeEmail);
                    if (employee) {
                        currentEmployee = employee;
                        openEmployeeModal(employee);
                    }
                });
            });
        }

        function openEmployeeModal(employee) {
            if (!employee) return;

            // Set profile image
            const modalProfileImage = document.getElementById('modalProfileImage');
            const modalProfileInitials = document.getElementById('modalProfileInitials');
            
            modalProfileImage.innerHTML = '';
            modalProfileInitials.textContent = getInitials(employee.emp_name);
            
            if (employee.emp_profile_pic_url) {
                const img = document.createElement('img');
                img.src = employee.emp_profile_pic_url;
                img.alt = employee.emp_name;
                img.onerror = () => {
                    // If image fails to load, show initials
                    img.style.display = 'none';
                    modalProfileInitials.style.display = 'flex';
                };
                modalProfileImage.appendChild(img);
                modalProfileInitials.style.display = 'none';
            } else {
                modalProfileInitials.style.display = 'flex';
            }

            // Set basic info
            document.getElementById('modalEmployeeName').textContent = employee.emp_name;
            document.getElementById('modalName').textContent = employee.emp_name;
            document.getElementById('modalEmail').textContent = employee.emp_email;
            document.getElementById('modalMobile').textContent = employee.emp_mobile || 'N/A';
            document.getElementById('modalDob').textContent = formatDate(employee.emp_dob);
            document.getElementById('modalJobRole').textContent = employee.emp_job_role || 'N/A';
            document.getElementById('modalDepartment').textContent = employee.emp_department || 'N/A';
            document.getElementById('modalJoiningDate').textContent = formatDate(employee.emp_joining_date);

            // Set experience details
            const experienceItem = document.getElementById('modalExperience');
            const companyItem = document.getElementById('experienceCompanyItem');
            const companyValue = document.getElementById('modalExperienceCompany');
            const yearsItem = document.getElementById('experienceYearsItem');
            const yearsValue = document.getElementById('modalExperienceYears');
            
            if (employee.emp_experience_status === 'Experienced' && employee.emp_years_of_experience > 0) {
                experienceItem.textContent = 'Experienced';
                companyValue.textContent = employee.emp_company_name || 'Not specified';
                yearsValue.textContent = employee.emp_years_of_experience;
                companyItem.style.display = 'block';
                yearsItem.style.display = 'block';
            } else {
                experienceItem.textContent = 'Fresher';
                companyItem.style.display = 'none';
                yearsItem.style.display = 'none';
            }

            // Set address info
            document.getElementById('modalAddress').textContent = employee.emp_address || 'N/A';
            document.getElementById('modalCity').textContent = employee.emp_city || 'N/A';
            document.getElementById('modalState').textContent = employee.emp_state || 'N/A';
            document.getElementById('modalZipcode').textContent = employee.emp_zipcode || 'N/A';

            // Set bank details
            document.getElementById('modalBank').textContent = employee.emp_bank || 'N/A';
            document.getElementById('modalAccount').textContent = employee.emp_account || 'N/A';
            document.getElementById('modalIfsc').textContent = employee.emp_ifsc || 'N/A';
            document.getElementById('modalBankBranch').textContent = employee.emp_bank_branch || 'N/A';

            // Set education details
            document.getElementById('modalSscSchool').textContent = employee.ssc_school || 'N/A';
            document.getElementById('modalSscYear').textContent = employee.ssc_year || 'N/A';
            document.getElementById('modalSscGrade').textContent = employee.ssc_grade || 'N/A';
            
            document.getElementById('modalInterCollege').textContent = employee.inter_college || 'N/A';
            document.getElementById('modalInterYear').textContent = employee.inter_year || 'N/A';
            document.getElementById('modalInterGrade').textContent = employee.inter_grade || 'N/A';
            document.getElementById('modalInterBranch').textContent = employee.inter_branch || 'N/A';
            
            document.getElementById('modalGradCollege').textContent = employee.grad_college || 'N/A';
            document.getElementById('modalGradYear').textContent = employee.grad_year || 'N/A';
            document.getElementById('modalGradGrade').textContent = employee.grad_grade || 'N/A';
            document.getElementById('modalGradDegree').textContent = employee.grad_degree || 'N/A';
            document.getElementById('modalGradBranch').textContent = employee.grad_branch || 'N/A';

            // Set up documents
            const documentsGrid = document.getElementById('documentsGrid');
            documentsGrid.innerHTML = '';

            const documents = [
                { name: 'Profile Picture', url: employee.emp_profile_pic_url },
                { name: 'SSC Certificate', url: employee.emp_ssc_doc_url },
                { name: 'Intermediate/Diploma', url: employee.emp_inter_doc_url },
                { name: 'Graduation Certificate', url: employee.emp_grad_doc_url },
                { name: 'Resume', url: employee.resume_url },
                { name: 'ID Proof', url: employee.id_proof_url },
                { name: 'Signed Document', url: employee.signed_document_url }
            ];

            if (employee.emp_experience_status === 'Experienced') {
                documents.push(
                    { name: 'Offer Letter', url: employee.emp_offer_letter_url },
                    { name: 'Relieving Letter', url: employee.emp_relieving_letter_url },
                    { name: 'Experience Certificate', url: employee.emp_experience_certificate_url },
                    { name: 'Salary Slip', url: employee.emp_salary_slip_url }
                );
            }

            documents.forEach(doc => {
                const docElement = document.createElement('div');
                docElement.className = 'doc-btn';
                
                if (doc.url) {
                    docElement.innerHTML = `
                        <h4>${doc.name}</h4>
                        <a href="#" class="download-doc" data-url="${doc.url}">Download</a>
                    `;
                } else {
                    docElement.innerHTML = `
                        <h4>${doc.name}</h4>
                        <a href="#" class="disabled" disabled>Not Available</a>
                    `;
                }
                documentsGrid.appendChild(docElement);
            });

            document.querySelectorAll('.download-doc').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const docUrl = this.getAttribute('data-url');
                    downloadDocument(docUrl);
                });
            });

            document.getElementById('downloadPdfBtn').onclick = () => {
                generatePdf(employee);
            };

            modal.style.display = 'block';
        }

        function generatePdf(employee) {
            if (!employee) return;

            const doc = new jsPDF();
            
            // Set document properties
            doc.setProperties({
                title: `Employee Profile - ${employee.emp_name}`,
                subject: 'Employee Information',
                author: 'Your Company Name',
                keywords: 'employee, profile, information',
                creator: 'Your Company HR System'
            });

            // Title and Profile Image
            doc.setFontSize(18);
            doc.setTextColor(40, 40, 40);
            doc.text(`${employee.emp_name}`, 14, 20);
                        // Profile Image Placeholder
                        doc.setDrawColor(200, 200, 200);
            doc.setFillColor(230, 230, 230);
            doc.roundedRect(160, 10, 30, 30, 3, 3, 'FD');
            doc.setFontSize(14);
            doc.setTextColor(100, 100, 100);
            doc.text(getInitials(employee.emp_name), 175, 25, { align: 'center', baseline: 'middle' });

            // Basic Info Section
            doc.setFontSize(12);
            doc.setTextColor(40, 40, 40);
            doc.text('Basic Information', 14, 40);
            doc.setDrawColor(200, 200, 200);
            doc.line(14, 42, 60, 42);

            const basicInfo = [
                ['Name:', employee.emp_name],
                ['Email:', employee.emp_email],
                ['Mobile:', employee.emp_mobile || 'N/A'],
                ['Date of Birth:', formatDate(employee.emp_dob)],
                ['Job Role:', employee.emp_job_role || 'N/A'],
                ['Department:', employee.emp_department || 'N/A'],
                ['Joining Date:', formatDate(employee.emp_joining_date)],
                ['Experience:', employee.emp_experience_status === 'Experienced' ? 
                    `${employee.emp_years_of_experience} years` : 'Fresher']
            ];

            if (employee.emp_experience_status === 'Experienced') {
                basicInfo.push(['Previous Company:', employee.emp_company_name || 'N/A']);
            }

            doc.autoTable({
                startY: 45,
                margin: { left: 14 },
                head: false,
                body: basicInfo,
                columnStyles: {
                    0: { cellWidth: 50, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3,
                    overflow: 'linebreak'
                },
                theme: 'grid'
            });

            // Address Section
            doc.setFontSize(12);
            doc.text('Address Information', 14, doc.lastAutoTable.finalY + 15);
            doc.line(14, doc.lastAutoTable.finalY + 17, 60, doc.lastAutoTable.finalY + 17);

            const addressInfo = [
                ['Address:', employee.emp_address || 'N/A'],
                ['City:', employee.emp_city || 'N/A'],
                ['State:', employee.emp_state || 'N/A'],
                ['Zipcode:', employee.emp_zipcode || 'N/A']
            ];

            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 20,
                margin: { left: 14 },
                head: false,
                body: addressInfo,
                columnStyles: {
                    0: { cellWidth: 30, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                theme: 'grid'
            });

            // Bank Details Section
            doc.setFontSize(12);
            doc.text('Bank Details', 105, 40);
            doc.line(105, 42, 140, 42);

            const bankInfo = [
                ['Bank Name:', employee.emp_bank || 'N/A'],
                ['Account No:', employee.emp_account || 'N/A'],
                ['IFSC Code:', employee.emp_ifsc || 'N/A'],
                ['Branch:', employee.emp_bank_branch || 'N/A']
            ];

            doc.autoTable({
                startY: 45,
                margin: { left: 105 },
                head: false,
                body: bankInfo,
                columnStyles: {
                    0: { cellWidth: 35, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                theme: 'grid'
            });

            // Education Sections
            let educationStartY = Math.max(
                doc.lastAutoTable.finalY + 10,
                doc.previousAutoTable ? doc.previousAutoTable.finalY + 10 : 0
            );

            // SSC Education
            doc.setFontSize(12);
            doc.text('SSC Education', 14, educationStartY);
            doc.line(14, educationStartY + 2, 45, educationStartY + 2);

            const sscInfo = [
                ['School:', employee.ssc_school || 'N/A'],
                ['Year:', employee.ssc_year || 'N/A'],
                ['Grade:', employee.ssc_grade || 'N/A']
            ];

            doc.autoTable({
                startY: educationStartY + 5,
                margin: { left: 14 },
                head: false,
                body: sscInfo,
                columnStyles: {
                    0: { cellWidth: 25, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                theme: 'grid'
            });

            // Intermediate/Diploma
            doc.setFontSize(12);
            doc.text('Intermediate/Diploma', 105, educationStartY);
            doc.line(105, educationStartY + 2, 160, educationStartY + 2);

            const interInfo = [
                ['College:', employee.inter_college || 'N/A'],
                ['Year:', employee.inter_year || 'N/A'],
                ['Grade:', employee.inter_grade || 'N/A'],
                ['Branch:', employee.inter_branch || 'N/A']
            ];

            doc.autoTable({
                startY: educationStartY + 5,
                margin: { left: 105 },
                head: false,
                body: interInfo,
                columnStyles: {
                    0: { cellWidth: 30, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                theme: 'grid'
            });

            // Graduation
            educationStartY = Math.max(
                doc.lastAutoTable.finalY + 10,
                doc.previousAutoTable.finalY + 10
            );

            doc.setFontSize(12);
            doc.text('Graduation Details', 14, educationStartY);
            doc.line(14, educationStartY + 2, 60, educationStartY + 2);

            const gradInfo = [
                ['University:', employee.grad_college || 'N/A'],
                ['Year:', employee.grad_year || 'N/A'],
                ['Grade:', employee.grad_grade || 'N/A'],
                ['Degree:', employee.grad_degree || 'N/A'],
                ['Branch:', employee.grad_branch || 'N/A']
            ];

            doc.autoTable({
                startY: educationStartY + 5,
                margin: { left: 14 },
                head: false,
                body: gradInfo,
                columnStyles: {
                    0: { cellWidth: 30, fontStyle: 'bold' },
                    1: { cellWidth: 'auto' }
                },
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                theme: 'grid'
            });

            // Documents List
            const documentsStartY = doc.lastAutoTable.finalY + 15;
            doc.setFontSize(12);
            doc.text('Documents', 14, documentsStartY);
            doc.line(14, documentsStartY + 2, 40, documentsStartY + 2);

            const documents = [
                { name: 'Profile Picture', status: employee.emp_profile_pic_url ? 'Available' : 'Not Available' },
                { name: 'SSC Certificate', status: employee.emp_ssc_doc_url ? 'Available' : 'Not Available' },
                { name: 'Intermediate/Diploma', status: employee.emp_inter_doc_url ? 'Available' : 'Not Available' },
                { name: 'Graduation Certificate', status: employee.emp_grad_doc_url ? 'Available' : 'Not Available' },
                { name: 'Resume', status: employee.resume_url ? 'Available' : 'Not Available' },
                { name: 'ID Proof', status: employee.id_proof_url ? 'Available' : 'Not Available' },
                { name: 'Signed Document', status: employee.signed_document_url ? 'Available' : 'Not Available' }
            ];

            if (employee.emp_experience_status === 'Experienced') {
                documents.push(
                    { name: 'Offer Letter', status: employee.emp_offer_letter_url ? 'Available' : 'Not Available' },
                    { name: 'Relieving Letter', status: employee.emp_relieving_letter_url ? 'Available' : 'Not Available' },
                    { name: 'Experience Certificate', status: employee.emp_experience_certificate_url ? 'Available' : 'Not Available' },
                    { name: 'Salary Slip', status: employee.emp_salary_slip_url ? 'Available' : 'Not Available' }
                );
            }

            doc.autoTable({
                startY: documentsStartY + 5,
                margin: { left: 14 },
                columns: [
                    { header: 'Document', dataKey: 'name' },
                    { header: 'Status', dataKey: 'status' }
                ],
                body: documents,
                styles: {
                    fontSize: 10,
                    cellPadding: 3
                },
                columnStyles: {
                    name: { fontStyle: 'bold' },
                    status: { 
                        cellWidth: 40,
                        halign: 'center',
                        fillColor: [255, 255, 255]
                    }
                },
                willDrawCell: (data) => {
                    if (data.column.dataKey === 'status') {
                        if (data.cell.raw === 'Available') {
                            data.cell.styles.fillColor = [220, 252, 231];
                            data.cell.styles.textColor = [22, 101, 52];
                        } else {
                            data.cell.styles.fillColor = [254, 226, 226];
                            data.cell.styles.textColor = [153, 27, 27];
                        }
                    }
                },
                theme: 'grid'
            });

            // Footer
            const footerY = 285;
            doc.setFontSize(8);
            doc.setTextColor(150, 150, 150);
            doc.text('Generated by Employee Onboarding System', 105, footerY, { align: 'center' });
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, footerY + 5, { align: 'center' });

            // Save the PDF
            doc.save(`Employee_${employee.emp_name.replace(/\s+/g, '_')}_Profile.pdf`);
        }
    </script>
</body>
</html>
